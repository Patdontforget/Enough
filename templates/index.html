<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-5xl mx-auto">
    <!-- Header -->
    <header class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-indigo-700">üìí ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>
      <div class="flex gap-2">
        <input id="search" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." 
          class="px-3 py-2 rounded-lg border border-gray-300 focus:ring focus:ring-indigo-200" />
        <button onclick="loadEntries()" 
          class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
      </div>
    </header>

    <!-- Form -->
    <div class="bg-white p-6 rounded-2xl shadow-md mb-6">
      <form id="entryForm" onsubmit="return submitForm(event)" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <input type="hidden" id="entryId" />
        <input id="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" required class="border p-2 rounded-lg" />
        <input id="amount" type="number" step="0.01" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" required class="border p-2 rounded-lg" />
        <input id="date" type="date" class="border p-2 rounded-lg" />
        <select id="kind" class="border p-2 rounded-lg">
          <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
          <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
        </select>
        <input id="category" placeholder="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà" class="border p-2 rounded-lg" />
        <input id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" class="border p-2 rounded-lg" />
        <div class="flex gap-2 col-span-full">
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" onclick="clearForm()" class="bg-gray-300 px-4 py-2 rounded-lg hover:bg-gray-400">‡∏•‡πâ‡∏≤‡∏á</button>
        </div>
      </form>
    </div>

    <!-- Stats -->
    <div id="stats" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"></div>

    <!-- Table -->
    <div class="bg-white rounded-2xl shadow-md overflow-hidden">
      <table class="w-full text-sm text-left">
        <thead class="bg-indigo-600 text-white">
          <tr>
            <th class="px-4 py-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
            <th class="px-4 py-3">‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="px-4 py-3">‡∏´‡∏°‡∏ß‡∏î</th>
            <th class="px-4 py-3">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th class="px-4 py-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th class="px-4 py-3">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
            <th class="px-4 py-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="divide-y divide-gray-200"></tbody>
      </table>
    </div>

    <!-- ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥ -->
    <footer class="text-center mt-6 text-gray-500">
      <p>‚ú® ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢: <b>‡∏õ‡∏ß‡∏µ‡∏†‡∏±‡∏ó‡∏£ ‡πÅ‡∏•‡∏∞ ‡πÅ‡∏û‡∏£‡∏ß‡∏≤</b> ‚ú®</p>
    </footer>
  </div>

<script>
const api = "/api";

async function loadEntries(){
  const q = document.getElementById("search").value.trim();
  let url = api + "/entries";
  if(q) url += "?q=" + encodeURIComponent(q);
  const res = await fetch(url);
  const data = await res.json();
  renderTable(data);
  loadStats();
}

function renderTable(entries){
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  for(const e of entries){
    const tr = document.createElement("tr");
    tr.className = "hover:bg-gray-50";
    tr.innerHTML = `
      <td class="px-4 py-2">${e.date||""}</td>
      <td class="px-4 py-2">${escapeHtml(e.title)}</td>
      <td class="px-4 py-2">${escapeHtml(e.category)}</td>
      <td class="px-4 py-2 ${e.kind === 'income' ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}">${e.kind}</td>
      <td class="px-4 py-2">${Number(e.amount).toLocaleString()}</td>
      <td class="px-4 py-2">${escapeHtml(e.note)}</td>
      <td class="px-4 py-2 space-x-2">
        <button onclick='editEntry("${e.id}")' class="bg-yellow-400 text-black px-2 py-1 rounded-lg hover:bg-yellow-500">‚úèÔ∏è</button>
        <button onclick='deleteEntry("${e.id}")' class="bg-red-600 text-white px-2 py-1 rounded-lg hover:bg-red-700">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  }
}

function escapeHtml(s){ return (s||"").toString().replace(/[&<>"']/g, 
  c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

async function submitForm(ev){
  ev.preventDefault();
  const id = document.getElementById("entryId").value;
  const payload = {
    title: document.getElementById("title").value,
    amount: parseFloat(document.getElementById("amount").value),
    date: document.getElementById("date").value || undefined,
    kind: document.getElementById("kind").value,
    category: document.getElementById("category").value,
    note: document.getElementById("note").value
  };
  if(id){
    await fetch(api + "/entries/" + id, { method: "PUT", headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  } else {
    await fetch(api + "/entries", { method: "POST", headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  }
  clearForm();
  loadEntries();
  return false;
}

function clearForm(){
  document.getElementById("entryId").value = "";
  document.getElementById("title").value = "";
  document.getElementById("amount").value = "";
  document.getElementById("date").value = "";
  document.getElementById("kind").value = "expense";
  document.getElementById("category").value = "";
  document.getElementById("note").value = "";
}

async function editEntry(id){
  const res = await fetch(api + "/entries/" + id);
  const e = await res.json();
  document.getElementById("entryId").value = e.id;
  document.getElementById("title").value = e.title;
  document.getElementById("amount").value = e.amount;
  document.getElementById("date").value = e.date || "";
  document.getElementById("kind").value = e.kind;
  document.getElementById("category").value = e.category;
  document.getElementById("note").value = e.note;
  window.scrollTo({top:0, behavior:"smooth"});
}

async function deleteEntry(id){
  if(!confirm("‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
  await fetch(api + "/entries/" + id, { method: "DELETE" });
  loadEntries();
}

async function loadStats(){
  const res = await fetch(api + "/stats");
  const s = await res.json();
  document.getElementById("stats").innerHTML = `
    <div class="bg-green-100 p-4 rounded-lg shadow text-center">
      <div class="text-green-700 font-bold">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div>
      <div class="text-2xl font-semibold text-green-600">${Number(s.income).toLocaleString()} ‡∏ø</div>
    </div>
    <div class="bg-red-100 p-4 rounded-lg shadow text-center">
      <div class="text-red-700 font-bold">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</div>
      <div class="text-2xl font-semibold text-red-600">${Number(s.expense).toLocaleString()} ‡∏ø</div>
    </div>
    <div class="bg-indigo-100 p-4 rounded-lg shadow text-center">
      <div class="text-indigo-700 font-bold">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
      <div class="text-2xl font-semibold text-indigo-600">${Number(s.balance).toLocaleString()} ‡∏ø</div>
    </div>
  `;
}

loadEntries();
</script>
</body>
</html>
